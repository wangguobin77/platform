(function(){!function(t,e,s){var r,n,i;return i="shapeshift",n={selector:"*",enableDrag:!0,enableCrossDrop:!0,enableResize:!0,enableTrash:!1,align:"center",colWidth:null,columns:null,minColumns:1,autoHeight:!0,maxHeight:null,minHeight:100,gutterX:10,gutterY:10,paddingX:10,paddingY:10,animated:!0,animateOnInit:!1,animationSpeed:225,animationThreshold:100,dragClone:!1,deleteClone:!0,dragRate:100,dragWhitelist:"*",crossDropWhitelist:"*",cutoffStart:null,cutoffEnd:null,handle:!1,cloneClass:"ss-cloned-child",activeClass:"ss-active-child",draggedClass:"ss-dragged-child",placeholderClass:"ss-placeholder-child",originalContainerClass:"ss-original-container",currentContainerClass:"ss-current-container",previousContainerClass:"ss-previous-container"},r=function(){function s(e,s){this.element=e,this.options=t.extend({},n,s),this.globals={},this.$container=t(e),this.errorCheck()&&this.init()}return s.prototype.errorCheck=function(){var t,e,s,r;return r=this.options,s=!1,e="Shapeshift ERROR:",null===r.colWidth&&(t=this.$container.children(r.selector),0===t.length&&(s=!0,console.error(""+e+" option colWidth must be specified if Shapeshift is initialized with no active children."))),!s},s.prototype.init=function(){return this.createEvents(),this.setGlobals(),this.setIdentifier(),this.setActiveChildren(),this.enableFeatures(),this.gridInit(),this.render(),this.afterInit()},s.prototype.createEvents=function(){var t,e,s=this;return e=this.options,t=this.$container,t.off("ss-arrange").on("ss-arrange",function(t,e){return null==e&&(e=!1),s.render(!1,e)}),t.off("ss-rearrange").on("ss-rearrange",function(){return s.render(!0)}),t.off("ss-setTargetPosition").on("ss-setTargetPosition",function(){return s.setTargetPosition()}),t.off("ss-destroy").on("ss-destroy",function(){return s.destroy()}),t.off("ss-shuffle").on("ss-shuffle",function(){return s.shuffle()})},s.prototype.setGlobals=function(){return this.globals.animated=this.options.animateOnInit,this.globals.dragging=!1},s.prototype.afterInit=function(){return this.globals.animated=this.options.animated},s.prototype.setIdentifier=function(){return this.identifier="shapeshifted_container_"+Math.random().toString(36).substring(7),this.$container.addClass(this.identifier)},s.prototype.enableFeatures=function(){if(this.options.enableResize&&this.enableResize(),this.options.enableDrag||this.options.enableCrossDrop)return this.enableDragNDrop()},s.prototype.setActiveChildren=function(){var e,s,r,n,i,o,a,l,h,d,p,u;for(a=this.options,e=this.$container.children(a.selector),s=a.activeClass,l=e.length,i=h=0;0<=l?h<l:h>l;i=0<=l?++h:--h)t(e[i]).addClass(s);for(this.setParsedChildren(),n=a.columns,u=[],i=d=0,p=this.parsedChildren.length;0<=p?d<p:d>p;i=0<=p?++d:--d)r=this.parsedChildren[i].colspan,o=a.minColumns,r>n&&r>o?(a.minColumns=r,u.push(console.error("Shapeshift ERROR: There are child elements that have a larger colspan than the minimum columns set through options.\noptions.minColumns has been set to "+r))):u.push(void 0);return u},s.prototype.setParsedChildren=function(){var e,s,r,n,i,o,a;for(s=this.$container.find("."+this.options.activeClass).filter(":visible"),o=s.length,i=[],n=a=0;0<=o?a<o:a>o;n=0<=o?++a:--a)e=t(s[n]),r={i:n,el:e,colspan:parseInt(e.attr("data-ss-colspan"))||1,height:e.outerHeight()},i.push(r);return this.parsedChildren=i},s.prototype.gridInit=function(){var t,e,s,r,n;return r=this.options.gutterX,this.options.colWidth>=1?this.globals.col_width=this.options.colWidth+r:(s=this.parsedChildren[0],e=s.el.outerWidth(),t=s.colspan,n=(e-(t-1)*r)/t,this.globals.col_width=n+r)},s.prototype.render=function(t,e){return null==t&&(t=!1),t&&this.setActiveChildren(),this.setGridColumns(),this.arrange(!1,e)},s.prototype.setGridColumns=function(){var t,e,s,r,n,i,o,a,l,h,d,p,u,g,c;if(i=this.globals,p=this.options,s=i.col_width,a=p.gutterX,u=p.paddingX,h=this.$container.innerWidth()-2*u,d=p.minColumns,n=p.columns||Math.floor((h+a)/s),d&&d>n&&(n=d),i.columns=n,e=this.parsedChildren.length,n>e){for(t=0,l=g=0,c=this.parsedChildren.length;0<=c?g<c:g>c;l=0<=c?++g:--g)r=this.parsedChildren[l].colspan,r+t<=n&&(t+=r);n=t}switch(i.child_offset=u,p.align){case"center":return o=n*s-a,i.child_offset+=(h-o)/2;case"right":return o=n*s-a,i.child_offset+=h-o}},s.prototype.arrange=function(t,e){var s,r,n,i,o,a,l,h,d,p,u,g,c,f,C,m,v,b;for(t&&this.setParsedChildren(),d=this.globals,f=this.options,r=this.$container,a=this.getPositions(),C=this.parsedChildren,v=C.length,n=d.animated&&v<=f.animationThreshold,i=f.animationSpeed,h=f.draggedClass,p=b=0;0<=v?b<v:b>v;p=0<=v?++b:--b)s=C[p].el,o=a[p],u=s.hasClass(h),u&&(m=f.placeholderClass,s=s.siblings("."+m)),n&&!u?s.stop(!0,!1).animate(o,i,function(){}):s.css(o);if(e&&(n?setTimeout(function(){return r.trigger("ss-drop-complete")},i):r.trigger("ss-drop-complete")),r.trigger("ss-arranged"),f.autoHeight)return l=d.container_height,g=f.maxHeight,c=f.minHeight,c&&l<c?l=c:g&&l>g&&(l=g),r.height(l)},s.prototype.getPositions=function(t){var e,s,r,n,i,o,a,l,h,d,p,u,g,c,f,C,m,v,b=this;for(null==t&&(t=!0),i=this.globals,h=this.options,a=h.gutterY,d=h.paddingY,n=h.draggedClass,p=this.parsedChildren,C=p.length,e=[],l=m=0,v=i.columns;0<=v?m<v:m>v;l=0<=v?++m:--m)e.push(d);return c=function(t){var s,r,n,o,l,h,d;if(s=t.col,r=t.colspan,o=t.col*i.col_width+i.child_offset,l=e[s],u[t.i]={left:o,top:l},e[s]+=t.height+a,r>=1){for(d=[],n=h=1;1<=r?h<r:h>r;n=1<=r?++h:--h)d.push(e[s+n]=e[s]);return d}},s=function(t){var s,r,n,i,o,a,l,h,d,p,u,g;for(d=e.length-t.colspan+1,h=e.slice(0).splice(0,d),s=void 0,l=u=0;0<=d?u<d:u>d;l=0<=d?++u:--u){for(r=b.lowestCol(h,l),n=t.colspan,i=e[r],o=!0,p=g=1;1<=n?g<n:g>n;p=1<=n?++g:--g)if(a=e[r+p],i<a){o=!1;break}if(o){s=r;break}}return s},f=[],g=function(){var t,e,r,n,i,o,a,l,h,d;for(i=[],n=o=0,l=f.length;0<=l?o<l:o>l;n=0<=l?++o:--o)r=f[n],r.col=s(r),r.col>=0&&(c(r),i.push(n));for(d=[],e=a=h=i.length-1;a>=0;e=a+=-1)t=i[e],d.push(f.splice(t,1));return d},u=[],(r=function(){var r,i,o;for(o=[],l=i=0;0<=C?i<C:i>C;l=0<=C?++i:--i)r=p[l],t||!r.el.hasClass(n)?(r.colspan>1?r.col=s(r):r.col=b.lowestCol(e),void 0===r.col?f.push(r):c(r),o.push(g())):o.push(void 0);return o})(),h.autoHeight&&(o=e[this.highestCol(e)]-a,i.container_height=o+d),u},s.prototype.enableDragNDrop=function(){var s,r,n,i,o,a,l,h,d,p,u,g,c,f,C,m,v,b,y=this;if(c=this.options,r=this.$container,o=c.activeClass,g=c.draggedClass,C=c.placeholderClass,f=c.originalContainerClass,l=c.currentContainerClass,m=c.previousContainerClass,h=c.deleteClone,p=c.dragRate,d=c.dragClone,a=c.cloneClass,i=n=s=b=v=null,u=!1,c.enableDrag&&r.children("."+o).filter(c.dragWhitelist).draggable({addClasses:!1,containment:"document",handle:c.handle,zIndex:9999,start:function(e,r){var o;return y.globals.dragging=!0,i=t(e.target),d&&(s=i.clone(!1,!1).insertBefore(i).addClass(a)),i.addClass(g),o=i.prop("tagName"),n=t("<"+o+" class='"+C+"' style='height: "+i.height()+"px; width: "+i.width()+"px'></"+o+">"),i.parent().addClass(f).addClass(l),b=i.outerHeight()/2,v=i.outerWidth()/2},drag:function(s,r){return u||d&&h&&t("."+l)[0]===t("."+f)[0]||(n.remove().appendTo("."+l),t("."+l).trigger("ss-setTargetPosition"),u=!0,e.setTimeout(function(){return u=!1},p)),r.position.left=s.pageX-i.parent().offset().left-v,r.position.top=s.pageY-i.parent().offset().top-b},stop:function(){var e,r,o;return y.globals.dragging=!1,r=t("."+f),e=t("."+l),o=t("."+m),i.removeClass(g),t("."+C).remove(),d&&(h&&t("."+l)[0]===t("."+f)[0]?(s.remove(),t("."+l).trigger("ss-rearrange")):(s.removeClass(a),r.shapeshift(r.data("plugin_shapeshift").options),e.shapeshift(e.data("plugin_shapeshift").options))),r[0]===e[0]?e.trigger("ss-rearranged",i):(r.trigger("ss-removed",i),e.trigger("ss-added",i)),r.trigger("ss-arrange").removeClass(f),e.trigger("ss-arrange",!0).removeClass(l),o.trigger("ss-arrange").removeClass(m),i=n=null}}),c.enableCrossDrop)return r.droppable({accept:c.crossDropWhitelist,tolerance:"intersect",over:function(e){return t("."+m).removeClass(m),t("."+l).removeClass(l).addClass(m),t(e.target).addClass(l)},drop:function(e,s){var r,n,o;if(y.options.enableTrash)return n=t("."+f),r=t("."+l),o=t("."+m),i=t(s.helper),r.trigger("ss-trashed",i),i.remove(),n.trigger("ss-rearrange").removeClass(f),r.trigger("ss-rearrange").removeClass(l),o.trigger("ss-arrange").removeClass(m)}})},s.prototype.setTargetPosition=function(){var e,s,r,n,i,o,a,l,h,d,p,u,g,c,f,C,m,v,b,y,_,T;if(d=this.options,d.enableTrash)return u=this.options.placeholderClass,t("."+u).remove();if(h=d.draggedClass,e=t("."+h),s=e.parent(),p=this.parsedChildren,i=this.getPositions(!1),b=i.length,f=e.offset().left-s.offset().left+this.globals.col_width/2,C=e.offset().top-s.offset().top+e.height()/2,m=9999999,v=0,b>1){for(a=d.cutoffStart+1||0,o=d.cutoffEnd||b,g=T=a;a<=o?T<o:T>o;g=a<=o?++T:--T)n=i[g],n&&(_=f-n.left,y=C-n.top,_>0&&y>0&&(l=Math.sqrt(y*y+_*_),l<m&&(m=l,v=g,g===b-1&&_>p[g].height/2&&v++)));v===p.length?(r=p[v-1].el,e.insertAfter(r)):(r=p[v].el,e.insertBefore(r))}else 1===b?(n=i[0],n.left<f?this.$container.append(e):this.$container.prepend(e)):this.$container.append(e);return this.arrange(!0),s[0]!==e.parent()[0]?(c=d.previousContainerClass,1==t("."+c).data("plugin_shapeshift").options.enableCrossDrop?t("."+c).trigger("ss-rearrange"):t("."+c)):void 0},s.prototype.enableResize=function(){var s,r,n,i=this;return s=this.options.animationSpeed,n=!1,r="resize."+this.identifier,t(e).on(r,function(){if(!n)return n=!0,setTimeout(function(){return i.render()},s/3),setTimeout(function(){return i.render()},s/3),setTimeout(function(){return n=!1,i.render()},s/3)})},s.prototype.shuffle=function(){var t;if(t=function(t,e){var s;return s=function(t){var e,s,r;for(s=void 0,r=void 0,e=t.length;e;)s=parseInt(Math.random()*e),r=t[--e],t[e]=t[s],t[s]=r;return t},t.each(function(){var r;return r=t.find("."+e).filter(":visible"),r.length?t.html(s(r)):this})},!this.globals.dragging)return t(this.$container,this.options.activeClass),this.enableFeatures(),this.$container.trigger("ss-rearrange")},s.prototype.lowestCol=function(t,e){var s,r,n,i;for(null==e&&(e=0),n=t.length,s=[],r=i=0;0<=n?i<n:i>n;r=0<=n?++i:--i)s.push([t[r],r]);return s.sort(function(t,e){var s;return s=t[0]-e[0],0===s&&(s=t[1]-e[1]),s}),s[e][1]},s.prototype.highestCol=function(s){return t.inArray(Math.max.apply(e,s),s)},s.prototype.destroy=function(){var t,e,s;return e=this.$container,e.off("ss-arrange"),e.off("ss-rearrange"),e.off("ss-setTargetPosition"),e.off("ss-destroy"),s=this.options.activeClass,t=e.find("."+s),this.options.enableDrag&&t.draggable("destroy"),this.options.enableCrossDrop&&e.droppable("destroy"),t.removeClass(s),e.removeClass(this.identifier)},s}(),t.fn[i]=function(s){return this.each(function(){var n,o,a,l;return o=null!=(a=t(this).attr("class"))&&null!=(l=a.match(/shapeshifted_container_\w+/))?l[0]:void 0,o&&(n="resize."+o,t(e).off(n),t(this).removeClass(o)),t.data(this,"plugin_"+i,new r(this,s))})}}(jQuery,window,document)}).call(this);
//# sourceMappingURL=jquery.shapeshift.js.map
